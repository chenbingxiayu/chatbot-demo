<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <title>Dialogggg</title>
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/botui/build/botui.min.css" />
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/botui/build/botui-theme-default.css" />
    <link href="https://cdn.bootcdn.net/ajax/libs/twitter-bootstrap/4.5.3/css/bootstrap.css" rel="stylesheet">
    <link href="https://cdn.bootcdn.net/ajax/libs/twitter-bootstrap/4.5.3/css/bootstrap.min.css" rel="stylesheet">
</head>
<body>
{% block body %}
<div class="container" style="background-color: #f7f8f8">
    <div class="jumbotron"  style="background-color: #f7f8f8">

        <br>
        <br>
    </div>
    <div class="row">
        <div class="col-md-3"></div>
        <div class="col-md-6">
            <div id="chatbox" style="height: 600px">
                <bot-ui style="background-color: aliceblue;"></bot-ui>
            </div>
        </div>
        <div class="col-md-3"></div>
    </div>
    <div class="jumbotron"  style="background-color: #f7f8f8">
        <br>
        <br>
    </div>
</div>

</body>
{% endblock body %}

{% load static %}
<script src="http://code.jquery.com/jquery-1.11.0.min.js"></script>
<script src="http://malsup.github.io/jquery.form.js"></script>
<script src="https://cdn.jsdelivr.net/vue/latest/vue.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/botui/build/botui.js"></script>
{% block javascript %}
<script>
    var botui = new BotUI('chatbox');
    var content = document.getElementsByTagName('chatbox');
    var user_input = 'default';

    function chatting (res) {
        botui.action.text({ // show 'text' action
                action: {
                    placeholder: 'Enter here'
                }
        }).then(function (res) { // get the result
            if(res.value != 'exit') {
                $(this).ajaxSubmit({
                  type: 'post',
                  url: "{% url 'auto_response' %}",
                  data:{
                      'post': res.value
                  },
                  success: function(data) {
                      response = data;
                      botui.message.add({
                        content: response
                      }).then(chatting())
                  }
                });
            } else {
                botui.message.add({
                    content: 'Bye bye!'
                });
            }
        });
    }


    var netid = 0;
    var passwd = 0;

    function verification () {
      botui.message.bot({
          delay: 500,
          content: 'Please input your PolyU netid and Password:'
        }).then (function () {
          return botui.action.text({
            delay: 1000,
            addMessage: false,
            action: {
              size: 30,
              placeholder: 'PolyU netid'
            }
          });
        }).then(function(res) {
            netid = res.value;
            return botui.action.text({
                addMessage: false,
                delay: 1000,
                action: {
                  size: 30,
                  sub_type: 'password',
                  placeholder: 'passwd'
                }
            });
        }).then(function(res) {
            passwd = res.value;

            /*
             ************************
             This part we need backend verification.
            */

            botui.message.add({
                content: 'Welcome!'
            });
            botui.message.add({
                content: 'If you want to talk to the counselor, take a quiz to get to know yourself, or talk to me after you know it.'
            });

            q1();



        });
    }




    botui.message.add({
        content: 'Hello, Are you a student in PolyU?'
    }).then(function () {
        return botui.action.button({
            addMessage: false, // so we could the address in message instead if 'Existing Address'
              action: [{
                text: 'Yes',
                value: 'yes'
              }, {
                text: 'No',
                value: 'no'
              }]
        })
    }).then(function(res) {
        if(res.value == 'no') {
            botui.message.human({
              delay: 500,
              content: 'No'
            });
            botui.message.add({
                delay: 600,
                content: 'Sorry! We only server for PolyU students.'
            });
            botui.message.add({
                delay: 700,
                content: 'Bye bye!'
            });
            end();
        } else {
            botui.message.human({
              delay: 500,
              content: res.text
            });
            verification();

        }

    })


    //  ***** Q1 *****
    function q1 () {
        botui.message.add({
            content: 'What\'s upsetting you recently?'
        }).then(function () {
            return botui.action.select({
                action: {
                    placeholder: "Select a option",
                    value: '0',
                    options: [
                        {value: "0", text: "Studies"},
                        {value: "1", text: "Interpersonal relationships"},
                        {value: "2", text: "Work"},
                        {value: "3", text: "Relationships"},
                        {value: "4", text: "Family"},
                        {value: "5", text: "Society"},
                        {value: "6", text: "Other"},
                        {value: "7", text: "None"},
                    ],
                    button: {
                        icon: 'check',
                        label: 'OK'
                    }
                }
            })
        }).then(function (res) {
            botui.message.add({
                content: 'Do you often feel depressed?'
            }).then(function (res) {
                return botui.action.button({
                    action: [{value: "1", text: "Very little"},
                {value: "2", text: "Less"},
                {value: "3", text: "Fair"},
                {value: "4", text: "More"},
                {value: "5", text: "Very much"}]

                })
            }).then(function (res) {
                botui.message.add({
                    content: 'How long does this low mood last?'
                }).then(function () {
                    return botui.action.button({
                        action:
                            [{value: "1", text: "Very few"},
                                {value: "2", text: "A few days"},
                                {value: "3", text: "A week"},
                                {value: "4", text: "More than a week"},
                                {value: "5", text: "More than a month"}]

                    })
        }).then(function (res) {
                    botui.message.add({
                        content: 'Will this emotional state affect your life at this moment?'
                    }).then(function () {
                        return botui.action.button({
                            action:
                                [{value: "1", text: "Very little"},
                                    {value: "2", text: "Less"},
                                    {value: "3", text: "Fair"},
                                    {value: "4", text: "More"},
                                    {value: "5", text: "Very much"}]

                        })
                    }).then(function (res) {
                        botui.message.add({
                            content: 'Have you often felt helpless lately?'
                        }).then(function () {
                            return botui.action.button({
                                action:

                                    [{value: "1", text: "Very little"},
                                        {value: "2", text: "Less"},
                                        {value: "3", text: "Fair"},
                                        {value: "4", text: "More"},
                                        {value: "5", text: "Very much"}]

                            })
                        })
                    })
                })
            })
        })
    }

</script>
{% endblock javascript %}
</html>