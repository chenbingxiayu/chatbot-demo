<!--<!DOCTYPE html>-->
<html>

<head>
    <meta http-equiv="content-type" content="text/html; charset=UTF-8">
    <title>Dialogggg</title>
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">


    <!-- <script src="https://cdnjs.cloudflare.com/ajax/libs/vue/2.5.14/vue.min.js"></script> -->
    <script src="https://cdn.jsdelivr.net/vue/latest/vue.min.js"></script>


    {% load static %}
    <script src="{% static 'botui-master/build/botui.js' %}"></script>
    <link rel="stylesheet" href="{% static 'botui-master/build/botui.min.css' %}" />
    <link rel="stylesheet" href="{% static 'botui-master/build/botui-theme-default.css' %}" />
    <link href="{% static 'fontawesome-free-5.15.3-web/css/all.css' %}" rel="stylesheet">

    <!-- <script src="https://cdn.jsdelivr.net/npm/botui/build/botui.js"></script>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/botui/build/botui.min.css" />
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/botui/build/botui-theme-default.css" /> -->


    <script src="http://code.jquery.com/jquery-1.11.0.min.js"></script>
    <script src="http://malsup.github.io/jquery.form.js"></script>


    <link href="https://cdn.bootcdn.net/ajax/libs/twitter-bootstrap/4.5.3/css/bootstrap.css" rel="stylesheet">
    <link href="https://cdn.bootcdn.net/ajax/libs/twitter-bootstrap/4.5.3/css/bootstrap.min.css" rel="stylesheet">


</head>


<style type="text/css">

    .profil > img {
        border: none !important;
        width: 48px;
        height: 48px;
    }
    
    .profil > img.agent {
      content: unset
    }

    body {
        width: 100%;
        height: 100%;
    }

    .top-banner {
        height: calc(100vw / 7.73);
        width: 100%;
        background: url("/static/Polly-graphics/general/top-banner.jpg")
            no-repeat center center;
        background-size: contain;
    }

    .top-description {
        background-color: #fcead9;
        width: 100%;
        height: auto;
        padding: 30px 50px;
    }

    .main-content {
        height: auto;
        background-color: #fefae4;
    }

    .login-form {
        margin-top: 80px;
    }

    .linkage {
        background-color: #fcead9;
        height: auto;
        padding-top: 80px;
        padding-bottom: 80px;
    }

    .linkage ul {
        list-style-type: none;
        color: #df643b;
        padding-left: 0px;
    }

    .linkage-item {
        font-size: 20px;
        color: #df643b;
        position: relative;
        width: 55%;
        border-top: 3px solid #df643b;
        padding: 5px 30px;
        font-weight: 500;
    }

    .linkage-item a {
        color: #df643b;
    }

    .linkage-item a:hover {
        color: #df643b;
        text-decoration: none;
    }

    .linkage-item:last-child {
        border-bottom: 3px solid #df643b;
    }

    .linkage-item::before {
        content: "";
        border-top: 20px solid #df643b;
        border-right: 12px solid transparent;
        border-left: 12px solid transparent;
        position: absolute;
        right: 10px;
        top: 10px;
        cursor: pointer;
    }

    .copyright {
        background-color: #ca3f6a;
        height: auto;
        padding: 20px 50px;
    }

    .copyright ul {
        display: inline-flex;
        list-style-type: none;
        color: white;
        padding-left: 0px;
    }

    .copyright-item {
        border-right: 1px solid white;
        padding: 0px 10px;
    }

    .copyright-item a {
        color: white;
    }

    .copyright-item a:hover {
        text-decoration: none;
    }

    .copyright-text {
        margin-top: 20px;
        color: white;
        text-align: right;
    }
    

    .wrap {
        width: 200px;
        height: 25px;
        /*background: #ebefff;*/
        position: relative;
        top: 50%;
        left: 50%;
        transform: translate(-50%, -50%);
        border-radius: 10px;
    }

    .stars {
        width: fit-content;
        margin: 0 auto;
        cursor: pointer;
    }

    .star {
        color: #91a6ff !important;
    }

    .rate {
        height: 50px;
        margin-left: -5px;
        padding: 5px;
        font-size: 25px;
        position: relative;
        cursor: pointer;
    }

    .rate input[type="radio"] {
        opacity: 0;
        position: absolute;
        top: 50%;
        left: 50%;
        transform: translate(-50%, 0%);
        pointer-events: none;
    }

    .star-over::after {
        font-family: 'Font Awesome 5 Free';
        font-weight: 900;
        font-size: 19px;
        content: "\f005";
        display: inline-block;
        color: #91a6ff;
        z-index: 1;
        position: absolute;
        top: 8px;
        left: 8.5px;
    }

    .rate:nth-child(1) .face::after {
        content: "\f119";
        /* ‚òπ */
    }

    .rate:nth-child(2) .face::after {
        content: "\f11a";
        /* üòê */
    }

    .rate:nth-child(3) .face::after {
        content: "\f118";
        /* üôÇ */
    }

    .rate:nth-child(4) .face::after {
        content: "\f580";
        /* üòä */
    }

    .rate:nth-child(5) .face::after {
        content: "\f59a";
        /* üòÑ */
    }

    .face {
        opacity: 0;
        position: absolute;
        width: 35px;
        height: 35px;
        background: #91a6ff;
        border-radius: 4px;
        top: -40px;
        left: 2px;
        transition: 0.2s;
        pointer-events: none;
    }

    .face::before {
        font-family: 'Font Awesome 5 Free';
        font-weight: 900;
        content: "\f0dd";
        display: inline-block;
        color: #91a6ff;
        z-index: 1;
        position: absolute;
        left: 9px;
        bottom: -15px;
    }

    .face::after {
        font-family: 'Font Awesome 5 Free';
        font-weight: 900;
        display: inline-block;
        color: #fff;
        z-index: 1;
        position: absolute;
        left: 6px;
        top: -1px;
    }

    .rate:hover .face {
        opacity: 1;
    }

    .max-width-2 {
        max-width: 1230px;
        margin: 0 auto;
        padding: 4em 2em;
        position: relative;
    }

    .chatbox-wrapper {
        background-color: #eff7d7;
        position: relative;
        height: 675px;
        width: 100%;
    }
      
    #chatbox {
        height: 100%;
        display: inline-flex;
        flex-direction: column;
        width: 100%;
    }


    .botui-container {
        {% comment %} height: calc(100% - ((100% - 4em - 60px) * 0.3)); {% endcomment %}
        background: url('../static/Polly-graphics/general/general-bg.png') no-repeat center center #eff7d7;
        background-size: cover;
        -o-background-size: cover;
        -moz-background-size: cover;
        -webkit-background-size: cover;
    }

    .botui-header {
        padding-top: 30%; 
        width: 100%;
        background: url('../static/Polly-graphics/general/general-top.png') no-repeat ;
        background-size: contain;
        -o-background-size: contain;
        -moz-background-size: contain;
        -webkit-background-size: contain;
        position: sticky;
        z-index: 1;
        top: 0;
    }

    .botui-header-icon {
        position: absolute;
        top: 5px;
        right: 10px;
        z-index: 10;

    }

    .icon-home {
        background: url('/static/Polly-graphics/general/home.png') no-repeat ;
        width: 25px;
        height: 25px;
        z-index: 1000;
        background-size: contain;
        cursor: pointer;
    }
    .icon-leave {
        background: url('/static/Polly-graphics/general/close-icon.png') no-repeat ;
        width: 25px;
        height: 25px;
        z-index: 1000;
        background-size: contain;
        cursor: pointer;
    }

    .botui-message-content {
        background-color: #c2c890;
        border-radius: 10px 10px 10px 5px;
        overflow-wrap: break-word;
    }

    .botui-message-content.human {
        background-color: #fccca5;
        border-radius: 10px 10px 10px 5px;
    }

    .justify-content-center.row {
        width: 100%;
    }
      
</style>

{% block body %}

<body>
    <section>
      <div class="top-banner"></div>
      <div class="top-description">
        <p>
          The Counselling and Wellness Section (CWS) of the Student Affairs
          Office (SAO) renders the timely and quality mental health support to
          students of The Hong Kong Polytechnic University (PolyU) via the
          non-face-to-face service mode besides the face-to-face platform.
        </p>
        <p>
          CWS embarks the
          <b><i>Counselling Chatbot Service, My Polly</i></b> which fit our
          students‚Äô need for the mental health service surpass accessibility;
          students in distress can approach our various psychological services
          through the ‚ÄúMy Polly‚Äù Chatbot. This Chatbot serves the purpose of the
          identification of students‚Äô service need and the referral of
          psychological services, i.e. online chat, face-to-face counselling and
          online psychoeducation materials.
        </p>
      </div>
    </section>
    <section class="main-content">
    <div class="container">
        <div class="max-width-2">
            <div class="row justify-content-center">
                <div class="col-sm col-md-8 col-lg-6">
                    <div class="chatbox-wrapper">
                        <div id="chatbox" class="botui">
                            <div class="botui-header">
                                <div class="botui-header-icon">
                                    <label class="icon-home"></label>    
                                    <label class="icon-leave"></label>    
                                </div>
                            </div>
                            <bot-ui ></bot-ui>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    </section>
    <section class="footer">
      <div class="linkage">
        <ul>
          <li class="linkage-item"><a href="#">Terms and Conditions</a></li>
          <li class="linkage-item"><a href="#">Mental Health 101</a></li>
          <li class="linkage-item">
            <a href="#">Making Counselling Appointment</a>
          </li>
          <li class="linkage-item"><a href="#">Emergency Support</a></li>
        </ul>
      </div>
      <div class="copyright">
        <ul>
          <li class="copyright-item"><a href="#">Sitemap</a></li>
          <li class="copyright-item"><a href="#">Contact Us</a></li>
          <li class="copyright-item">
            <a href="#">Privacy Policy Statement</a>
          </li>
          <li class="copyright-item">
            <a href="#">Personal Information Collection Statement</a>
          </li>
          <li class="copyright-item"><a href="#">Accessibility</a></li>
        </ul>
        <p class="copyright-text">
          Copyright ¬© The Hong Kong Polytechnic Univeristy Reserved. 2020
        </p>
      </div>
    </section>

</body>
{% endblock body %}




{% load static %}
{% block javascript %}
<script>
    // set date and time
    {% comment %} var office_hour = true; {% endcomment %}

    function isSAOWorkingHours(now) {
        var weekday = now.getDay()
        var hours = now.getHours();
        // Mon - Fri
        if (weekday >= 1 && weekday <=5) {
            // 9:00-19:00
            if (hours >= 9 && hours < 19) {
                return true;
            }
        }

        // Sat
        if (weekday == 6) {
            // 9:00 - 12:00
            if(hours >=9 && hours < 12) {
                return true;
            }
        }
        return false;
    }

    // scroll to top
    $(".container").scrollTop();

    var botui = new BotUI('chatbox');
    var content = document.getElementsByTagName('chatbox');
    $(".botui-container").animate({ scrollTop: 0}, 1000);
    var user_input = 'default';
    var netid = 0;
    var passwd = 0;
    var score = 0;
    var answers = {};
    var personalInfo = {};
    var name = 'User';
    var polly = '{% static "Polly-graphics/general/polly.png" %}';
    var client = '{% static "Polly-graphics/general/student.png" %}';

    $("body").on('click', '.dropdown', function() {
        $(".botui-container").animate({ scrollTop: $('.botui-container').prop("scrollHeight")}, 1000);
    });


    select_language()
        .then(
            get_name
        )
        .then(
            T_and_C_split
        ).then(
            questions

        // questions

        // T_and_C_of_OCS
        // low
        // medium
        // high
    )

    function login() {
        return botui.message.add({
            photo: polly,
            content: 'Hello (Greeting Message 1), Are you a student in PolyU?'

        }).then(function () {
            return botui.action.button({
                addMessage: false,
                action: [{
                    text: 'Yes',
                    value: 'yes'
                }, {
                    text: 'No',
                    value: 'no'
                }]
            })
        }).then(function (res) {
            if (res.value == 'no') {
                return botui.message.human({
                    delay: 500,
                    photo: client,
                    content: 'No'
                }).then(function () {
                    return botui.message.add({
                        loading: true,
                        delay: 1000,
                        photo: polly,
                        content: 'Sorry! We only server for PolyU students.'
                    });
                }).then(function () {
                    return botui.message.add({
                        photo: polly,
                        loading: true,
                        delay: 500,
                        content: 'Bye bye!'
                    })
                }).then(end);
            } else {
                return botui.message.human({
                    photo: client,
                    delay: 500,
                    content: res.text
                })
            }
        })
    }

    function verification() {
        return botui.message.bot({
            photo: polly,
            loading: true,
            delay: 1500,
            content: 'Please input your PolyU netid and Password:'
        }).then(function () {
            return botui.action.text({
                addMessage: false,
                action: {
                    size: 30,
                    placeholder: 'PolyU netid'
                }
            });
        }).then(function (res) {
            netid = res.value;
            return botui.action.text({
                addMessage: false,
                action: {
                    size: 30,
                    sub_type: 'password',
                    placeholder: 'passwd'
                }
            });
        }).then(function (res) {
            passwd = res.value;
            /*
             ************************
             ## netid & passwd has stored in variables.
             This part we need backend verification.
            */
        })
    }

    function select_language() {
        return botui.message.bot({
            photo: polly,
            loading: true,
            searchselect: true,
            delay: 1000,
            content: 'Ë´ãÈÅ∏ÊìáË™ûË®Ä Please select your language'
        }).then(function () {
            return botui.action.select({
                addMessage: false,
                action: {
                    placeholder: "Please select a language",
                    value: '2',
                    options: [
                        { value: "0", text: "ÁπÅÈ´î‰∏≠Êñá" },
                        { value: "1", text: "ÁÆÄ‰Ωì‰∏≠Êñá" },
                        { value: "2", text: "English" },
                    ],
                    button: {
                        icon: 'check',
                        label: 'OK'
                    }
                }
            }).then(function (res) {
                return botui.message.human({
                    photo: client,
                    delay: 500,
                    content: res.text
                })
            })
        })
    }

    function get_name() {
        return botui.message.bot({
            photo: polly,
            loading: true,
            delay: 3000,
            content: 'Hi there! I\‚Äôm Polly, your counselling Chatbot. I\'m here to understand your service need and provide you with appropriate services, i.e. online chat, face-to-face counselling booking and online psycho-education materials.<br/><br/>To know more about SAO services, please visit the website<br/><a href="https://www.polyu.edu.hk/sao/" target ="_blank">https://www.polyu.edu.hk/sao/</a> '
        }).then(function () {
            return botui.message.bot({
                loading: true,
                photo: polly,
                delay: 1000,
                content: 'May I know your name?'
            })
        }).then(function () {
            return botui.action.text({
                addMessage: false,
                action: {
                    size: 30,
                    placeholder: 'Nickname'
                }
            });
        }).then(function (res) {
            name = res.value;
            return botui.message.human({
                photo: client,
                delay: 500,
                content: res.value
            })
        })
    }



    function T_and_C_split() {
        var ESI = "";
        var office_hour = isSAOWorkingHours(new Date());
        if (office_hour == false) {
            ESI = '<a href="https://www.polyu.edu.hk/sao/cws/student-counselling/emergency-support/non-office-hours/" target ="_blank">Emergency support information</a>'
        } else {
            ESI = '<a href="https://www.polyu.edu.hk/sao/cws/student-counselling/emergency-support/office-hours/" target ="_blank">Emergency support information</a>'
        }
        return botui.message.bot({
            loading: true,
            photo: polly,
            delay: 2000,
            content: 'Hi ' + name + ', you need to note the followings prior using \"My Polly\":</br></br>Important Notes:</br>In case of emergency and when there is an imminent hazard posed to you and others, please call 999 or go to the nearest emergency service / A&E service.' +
                '</br></br>Please visit the SAO/CWS website for more emergency support information.</br></br>' + ESI + '</br>'
        }).then(function () {
            return botui.action.button({
                addMessage: false,
                photo: client,
                action: [{
                    text: 'Got it',
                }]
            })
        }).then(function (res) {
            return botui.message.human({
                photo: client,
                delay: 500,
                content: res.text
            })
        }).then(function (res) {
            return botui.message.bot({
                    loading: true,
                    photo: polly,
                    delay: 2000,
                    content: '<p><b>My Polly Counselling Chatbot Service</b></p>\n' +
                        '<br/>\n' +
                        '<p>(The Terms and Conditions are only available in English.)</p>\n' +
                        '<br/>\n' +
                        '<p><b>Use of this service</b></p>\n' +
                        '<p>Initiated by the SAO Counselling & Wellness Section (CWS), My Polly Counselling Chatbot Service (the ‚ÄúService‚Äù) is available to all registered students of The Hong Kong Polytechnic University (the ‚ÄúUniversity‚Äù) aged 18 or above.</p>\n' +
                        '<br/>\n' +
                        '<p>This Chatbot serves the purpose of identifying students‚Äô service need and the referral of psychological services, ie online chat/ face-to- face counselling / online psychoeducation materials/ Non-office-hour counseling (non-crisis) / Community helplines. </p>\n'
            })
        }).then(function () {
            return botui.action.button({
                    addMessage: false,
                    photo: client,
                    action: [{
                        text: 'Read more',
                    }]
            })
        }).then(function () {
            return botui.message.bot({
                loading: true,
                photo: polly,
                delay: 2000,
                content:
                '<br/>\n' +
                '<p>The Service intends to render \'remote\' support through the secured online communication. However, limitation in using the Service may exist due to a number of factors, such as technical issues (both hardware and software), instability of internet connections and lack of direct interaction. The overall service quality and user experience may thereby be affected. If possible, staff of CWS may contact with the user for the service follow-up whenever necessary. </p>\n' +
                '<br/>\n' +
                '<p>The staff of CWS will follow its protocol in providing the Service. By accepting the Service, the user of the Service shall comply with the crisis protocol suggested by the staff of CWS including calling 999, notifying police and seeking help from emergency hospital services.</p>\n'
            })
        }).then(function () {
            return botui.action.button({
                addMessage: false,
                photo: client,
                action: [{
                    text: 'Read more',
                }]
            })
        }).then(function () {
            return botui.message.bot({
                loading: true,
                photo: polly,
                delay: 2000,
                content:
                '<br/>\n' +
                '<p>There are situations that the staff of CWS is ethically obligated to take actions to protect the user or others from harm including disclosing the personal particulars of the user of the Service to the extent necessary. These may include contacting family members, assisting hospitalization, notifying any potential victim(s) or the police. To the extent practicable, CWS will discuss with the user prior taking such actions.</p>\n' +
                '<br/>\n' +
                '<p>There will be no guarantee of any expected results or outcome from the Service. Service user shall not hold CWS responsible for the acts of the Service user. </p>\n' +
                '<br/>\n' +
                '<p>To protect the confidentiality of the service and service users, please do not make record of service in any form. </p>\n' +
                '<br/>\n' +
                '<p>You may look into the Privacy Policy Statement of PolyU <a href="https://www.polyu.edu.hk/privacy-policy-statement/" target="_blank">HERE</a>. </p>\n' +
                '<br/>\n' +
                '<p>As for the Personal Information Collection Statement, please click <a href="https://www.polyu.edu.hk/ar/web/en/pics/index.html" target="_blank">HERE</a>.</p>'
            })
        }).then(function () {
            return botui.message.bot({
                loading: true,
                photo: polly,
                delay: 5000,
                content: 'By clicking \"Hi, Polly\" to accept the above terms and conditions.'
            })
        }).then(function () {
            return botui.action.button({
                addMessage: false,
                photo: client,
                action: [
                    {text: 'No, I stop here.', value: false},
                    {text: 'Hi, Polly', value: true},
                ]
            })
        }).then(function (res) {
            if (res.value == false) {
                return botui.message.bot({
                    loading: true,
                    photo: polly,
                    delay: 2000,
                    content: 'You are always welcome to contact SAO counsellors at (852)27666800 for enquiries.',
                }).then(end);
            } else {
                return botui.message.bot({
                    human: true,
                    photo: client,
                    content: res.text,
                })
            }
        })
    }

    function questions() {
        return botui.message.bot({
            loading: true,
            photo: polly,
            delay: 2500,
            content: 'To let me know your concern(s), mental well-being and help-seeking behaviour, please answer a few questions below. Once you have completed them, I will suggest the types of services or information you may connect with.<br/><br/> The following questions are not supposed to treat as any formal psychological or diagnostic assessment.'
        }).then(function () {
            return botui.message.bot({
                loading: true,
                delay: 1500,
                photo: polly,
                content: 'Q1. What bring(s) you here to chat with us? (Can select more than one item)'
            }).then(function () {
                $(".botui-container").animate({ scrollTop: $('.botui-container').prop("scrollHeight")}, 1000);

                return botui.action.select({
                    addMessage: false,
                    action: {
                        placeholder: "Select a option",
                        multipleselect: true,
                        value: 0,
                        options: [
                            {value: 0, text: 'Academic' },
                            {value: 1, text: 'Relationship' },
                            {value: 2, text: 'Career' },
                            {value: 3, text: 'Family' },
                            {value: 4, text: 'Mental Health' },
                            {value: 5, text: 'Other' },
                        ],
                        button: {
                            icon: 'check',
                            label: 'OK'
                        }
                    }
                }).then(function (res) {
                    answers[1] = 'Q1. What bring(s) you here to chat with us? (Can select more than one item)<br/><b><font color="#FF0000">' + res.text + '</font></b><br/>'
                    // console.log(answers)

                    return botui.message.human({
                        photo: client,
                        delay: 500,
                        content: res.text
                    }).then(function () {
                        return botui.message.bot({
                            loading: true,
                            delay: 1000,
                            photo: polly,
                            content: 'I see, you are now facing the issue(s) comprising ' + res.text + '.'
                        })
                    })
                })
            })
        }).then(function () {
            return botui.message.bot({
                loading: true,
                delay: 1500,
                photo: polly,
                content: 'Q2. In facing the issues indicated, are you encountering the feeling of sadness, worry or tension now?'
            }).then(function () {
                return botui.action.button({
                    addMessage: false,
                    action: [
                        { text: 'Yes', value: 1 },
                        { text: 'No', value: 0 }
                    ]
                }).then(function (res) {
                    answers[2] = 'Q2. In facing the issues indicated, are you encountering the feeling of sadness, worry or tension now?<br/><b><font color="#FF0000">' + res.text + '</font></b><br/>'
                    if (res.value == 0) {
                        return botui.message.human({
                            photo: client,
                            delay: 500,
                            content: res.text,
                        }).then(function (res) {
                            return botui.message.bot({
                                loading: true,
                                delay: 1500,
                                photo: polly,
                                content: 'Keep it up! We encourage you to take a look at the "Mental Health 101" to learn more tips for enhancing your psychological and mental wellness.'
                            }).then(mental_health_101)
                        });
                    }
                    score += res.value;
                    console.log(score);
                    return botui.message.human({
                        photo: client,
                        delay: 500,
                        content: res.text
                    }).then(function () {
                        return botui.message.bot({
                            loading: true,
                            delay: 1500,
                            photo: polly,
                            content: 'It is natural for us to experience these feelings in our daily life.'
                        })
                    })
                })
            })
        }).then(function () {
            return botui.message.bot({
                loading: true,
                delay: 1500,
                photo: polly,
                content: 'Q3. How often do you experience the feeling of sadness, worry or tension?'
            })
        }).then(function () {
            return botui.action.button({
                addMessage: false,
                action: [
                    { text: 'Rarely', value: 1 },
                    { text: 'Seldom', value: 2 },
                    { text: 'Sometimes', value: 3 },
                    { text: 'Often', value: 4 },
                    { text: 'Always', value: 5 },
                ]
            }).then(function (res) {
                answers[3] = 'Q3. How often do you experience the feeling of sadness, worry or tension?<br/><b><font color="#FF0000">' + res.text + '</font></b><br/>'
                score += res.value;
                console.log(score);

                return botui.message.human({
                    photo: client,
                    delay: 500,
                    content: res.text
                }).then(function () {
                    return botui.message.bot({
                        delay: 2500,
                        loading: true,
                        photo: polly,
                        content: 'According to the Psychologist Nathaniel Branden, \"The fisrt step toward change is awareness.\" It aids our self-understanding and steps of healing to take.'
                    }).then(function () {
                        return botui.message.bot({
                            delay: 1000,
                            loading: true,
                            photo: polly,
                            content: 'You show aware of your feelings happening to you.'
                        })
                    })
                })
            })
        }).then(function () {
            return botui.message.bot({
                loading: true,
                delay: 2000,
                photo: polly,
                content: 'Q4. How often is your daily life get affected by the feelings mentioned above?'
            }).then(function () {
                return botui.action.button({
                    addMessage: false,
                    action: [
                        { text: 'Rarely', value: 1 },
                        { text: 'Seldom', value: 2 },
                        { text: 'Sometimes', value: 3 },
                        { text: 'Often', value: 4 },
                        { text: 'Always', value: 5 },
                    ]
                }).then(function (res) {
                    answers[4] = 'Q4. How often is your daily life get affected by the feelings mentioned above?<br/><b><font color="#FF0000">' + res.text + '</font></b><br/>'
                    score += res.value;
                    console.log(score);
                    return botui.message.human({
                        photo: client,
                        delay: 500,
                        content: res.text
                    }).then(function () {
                        return botui.message.bot({
                            loading: true,
                            photo: polly,
                            delay: 1500,
                            content: 'You are aware that your daily life is getting affected by these feelings.'
                        })
                    })
                })
            })
        }).then(function () {
            return botui.message.bot({
                loading: true,
                delay: 2500,
                photo: polly,
                content: 'Q5. Have you been trying to cope with your sadness\/worry or tension through positive ways? (e.g. practising physical exercise, deep breathing, listening to music, etc.)'
            }).then(function () {
                return botui.action.button({
                    addMessage: false,
                    action: [
                        { text: 'Yes', value: 0 },
                        { text: 'No', value: 1 }
                    ]
                }).then(function (res) {
                    answers[5] = 'Q5. Have you been trying to cope with your sadness\/worry or tension through positive ways? (e.g. practising physical exercise, deep breathing, listening to music, etc.)<br/><b><font color="#FF0000">' + res.text + '</font></b><br/>'
                    score += res.value;
                    console.log(score);
                    botui.message.human({
                            photo: client,
                            delay: 500,
                            content: res.text
                    });
                    if (res.value == 0) {
                        return botui.message.bot({
                                loading: true,
                                delay: 2000,
                                photo: polly,
                                content: 'It is crucial to find some positive coping strategies in dealing with the unsettled sadness\/worry or tension'
                        }).then(function () {
                            return botui.message.bot({
                                loading: true,
                                delay: 1500,
                                photo: polly,
                                content: 'Q6. Do you feel effective when using these coping strategies?'
                            }).then(function () {
                                return botui.action.button({
                                    addMessage: false,
                                    action: [
                                        { text: 'Yes', value: 0 },
                                        { text: 'No', value: 1 }
                                    ]
                                }).then(function (res) {
                                    answers[6] = 'Q6. Do you feel effective when using these coping strategies?<br/><b><font color="#FF0000">' + res.text + '</font></b><br/>'
                                    score += res.value;
                                    console.log(score);
                                    botui.message.human({
                                            photo: client,
                                            delay: 500,
                                            content: res.text
                                    });
                                })
                            })
                        })
                    } else {
                        return botui.message.bot({
                            loading: true,
                            delay: 2000,
                            photo: polly,
                            content: 'It is crucial to find some positive coping strategies in dealing with the unsettled sadness\/worry or tension'
                        }).then(function () {
                            return botui.message.bot({
                                loading: true,
                                delay: 1500,
                                photo: polly,
                                content: 'Q6. Are you able to manage your sadness/worry or tension at this moment?'
                            }).then(function () {
                                return botui.action.button({
                                    addMessage: false,
                                    action: [
                                        { text: 'Yes', value: 0 },
                                        { text: 'No', value: 1 }
                                    ]
                                }).then(function (res) {
                                    answers[6] = 'Q6. Are you able to manage your sadness/worry or tension at this moment?<br/><b><font color="#FF0000">' + res.text + '</font></b><br/>'
                                    score += res.value;
                                    console.log(score);
                                    return botui.message.human({
                                        photo: client,
                                        delay: 500,
                                        content: res.text
                                    })
                                })
                            })
                        })
                    }
                })
            })
        }).then(confirm_answer)
    }


    function confirm_answer() {
        return botui.message.bot({
            loading: true,
            photo: polly,
            delay: 2000,
            content: 'Kindly confirm your answer:'
        }).then(function () {
            var temp = '';
            for (var i = 1; i <= 6; i++) {
                temp += '<br/>' + answers[i];
            }
            return botui.message.bot({
                loading: true,
                delay: 2000,
                photo: polly,
                content: temp
            })
        }).then(function () {
            return botui.action.button({
                addMessage: false,
                action: [
                    { text: 'Cancel (Redirect to Q1)', value: false },
                    { text: 'Confirm', value: true },
                ]
            })
        }).then(function (res) {
            if (res.value == false) {
                score = 0;
                answers = {};
                return botui.message.human({
                    photo: client,
                    delay: 500,
                    content: res.text
                }).then(questions);
            } else {
                return botui.message.human({
                    photo: client,
                    delay: 500,
                    content: res.text
                }).then(dispatch);
            }
        })
    }


    function dispatch() {
        if (score <= 6) {
            low();
        } else if (score <= 10) {
            medium();
        } else {
            high();
        }
    }

    function low() {
        return botui.message.bot({
            loading: true,
            delay: 3000,
            photo: polly,
            content: 'Your answers show that you rarely or seldom encounter the feeling mentioned above, and you can manage your life well.'
        }).then(function () {
            return botui.message.bot({
                loading: true,
                delay: 3500,
                photo: polly,
                content: 'Keep it up! We encourage you to take a look at the "Mental Health 101" to learn more tips for enhancing your psychological and mental wellness.'
            })
        }).then(function () {
            return botui.action.button({
                addMessage: false,
                action: [
                    { text: 'Mental Health 101' }
                ]
            }).then(function (res) {
                return botui.message.human({
                    photo: client,
                    delay: 500,
                    content: res.text
                })
            })
        }).then(mental_health_101)
    }

    function medium() {
        botui.message.bot({
            loading: true,
            delay: 1000,
            photo: polly,
            content: 'Your answers show that you quite often experience the feeling mentioned above, and you feel your daily life get affected sometimes.'
        }).then(mid_recommendations)
    }

    function mid_recommendations() {
        var office_hour = isSAOWorkingHours(new Date());
        if (office_hour == true) {
                return botui.message.bot({
                    loading: true,
                    delay: 1000,
                    photo: polly,
                    content: 'We recommend you to reach out our counsellors.<br/><br/>1. Making Appointment with Counsellors<br/><br/>Apart from that, you can choose other services as below:<br/><br/>2. Mental Health 101<br/>3. Immediate Contact with SAO Counsellor<br/>4. Online Chat Service<br/>5. Community Helpline'
                }).then(function(){
                    return botui.action.button({
                        addMessage: false,
                        action: [
                            { text: 'Make Appointment with SAO Counsellors', value: 3 },
                            { text: 'Mental Health 101', value: 1 },
                            { text: 'Immediate Contact with SAO Counsellors', value: 4 },
                            { text: 'Online Chat Service(Live)', value: 2 },
                            { text: 'Community Helpline', value: 6 },
                        ]
                    }).then(function (res) {
                        if (res.value == 1) {
                            return botui.message.human({
                                delay: 500,
                                photo: client,
                                content: res.text
                            }).then(mental_health_101);
                        }
                        if (res.value == 2) {
                            return botui.message.human({
                                delay: 500,
                                photo: client,
                                content: res.text
                            }).then(T_and_C_of_OCS);
                        }
                        if (res.value == 3) {
                            return botui.message.human({
                                delay: 500,
                                photo: client,
                                content: res.text
                            }).then(make_appointment_with_counsellors);
                        }
                        if (res.value == 4) {
                            return botui.message.human({
                                delay: 500,
                                photo: client,
                                content: res.text
                            }).then(contact_with_counsellors);
                        }
                        if (res.value == 5) {
                            return botui.message.human({
                                delay: 500,
                                photo: client,
                                content: res.text
                            }).then(polyu_line);
                        }
                        if (res.value == 6) {
                            return botui.message.human({
                                delay: 500,
                                photo: client,
                                content: res.text
                            }).then(community_helpline);
                        }
                    })
                })
        } else {
                return botui.message.bot({
                    loading: true,
                    delay: 1000,
                    photo: polly,
                    content: 'We recommend you to reach out our counsellors.<br/><br/>1. Making Appointment with SAO counsellors<br/><br/>Apart from that, you can choose other services as below:<br/><br/>2. Mental Health 101<br/>3. Immediate Contact with PolyU-Line Counsellors: (852)81001583<br/>4. Community Helpline'
                }).then(function(){
                    return botui.action.button({
                        addMessage: false,
                        action: [
                            { text: 'Make Appointment with SAO Counsellors', value: 3 },
                            { text: 'Mental Health 101', value: 1 },
                            { text: 'Immediate Contact with PolyU-Line Counsellors: (852)81001583', value: 5 },
                            { text: 'Community Helpline', value: 6 },
                        ]
                    }).then(function (res) {
                        if (res.value == 1) {
                            return botui.message.human({
                                delay: 500,
                                photo: client,
                                content: res.text
                            }).then(mental_health_101);
                        }
                        if (res.value == 2) {
                            return botui.message.human({
                                delay: 500,
                                photo: client,
                                content: res.text
                            }).then(T_and_C_of_OCS);
                        }
                        if (res.value == 3) {
                            return botui.message.human({
                                delay: 500,
                                photo: client,
                                content: res.text
                            }).then(make_appointment_with_counsellors);
                        }
                        if (res.value == 4) {
                            return botui.message.human({
                                delay: 500,
                                photo: client,
                                content: res.text
                            }).then(contact_with_counsellors);
                        }
                        if (res.value == 5) {
                            return botui.message.human({
                                delay: 500,
                                photo: client,
                                content: res.text
                            }).then(polyu_line);
                        }
                        if (res.value == 6) {
                            return botui.message.human({
                                delay: 500,
                                photo: client,
                                content: res.text
                            }).then(community_helpline);
                        }
                    })
                })
        }
    }



    function high() {
        score = 20
        return botui.message.bot({
            loading: true,
            delay: 2000,
            photo: polly,
            content: 'Your answers show that you always experience the feeling mentioned above, and you feel your daily life always get affected.'
        }).then(high_recommendations)
    }

    function high_recommendations() {
        var office_hour = isSAOWorkingHours(new Date());
        if (office_hour == true) {
            return botui.message.bot({
                loading: true,
                photo: polly,
                delay: 3000,
                content: 'Please do not hestitate to seek for professional help.<br/><br/>' +
                    '<font color=blue>In case of emergency and when there is an imminent hazard posed to you and others, please call 999 or go to the nearest emergency service / A&E service.</font><br/></br>' +
                    '1. Immediate Contact with SAO Counsellors<br/><br/>Apart from that, you can choose other services as below:<br/><br/>2. Making Appointment with SAO Counsellors<br/>3. Community Helpline'
            }).then(function () {
                return botui.action.button({
                    addMessage: false,
                    action: [
                        { text: 'Immediate Contact with SAO Counsellors', value: 4 },
                        { text: 'Make Appointment with SAO Counsellors', value: 3 },
                        { text: 'Community Helpline', value: 6 },
                    ]
                })
            }).then(function (res) {
                if (res.value == 3) {
                    return botui.message.human({
                        delay: 500,
                        photo: client,
                        content: res.text,
                    }).then(make_appointment_with_counsellors);
                }
                if (res.value == 4) {
                    return botui.message.human({
                        delay: 500,
                        photo: client,
                        content: res.text,
                    }).then(contact_with_counsellors);
                }
                if (res.value == 5) {
                    return botui.message.human({
                        delay: 500,
                        photo: client,
                        content: res.text,
                    }).then(polyu_line);
                }
                if (res.value == 6) {
                    return botui.message.human({
                        delay: 500,
                        photo: client,
                        content: res.text,
                    }).then(community_helpline);
                }
            })
        } else {
            return botui.message.bot({
                loading: true,
                delay: 3000,
                photo: polly,
                content: 'Please do not hestitate to seek for professional help.<br/><br/>' +
                    '<font color=blue>In case of emergency and when there is an imminent hazard posed to you and others, please call 999 or go to the nearest emergency service / A&E service.</font><br/></br>' +
                    '1. Immediate Contact with PolyU-Line Counsellors: (852)81001583<br/><br/>Apart from that, you can choose other services as below:<br/><br/>2. Making Appointment with SAO Counsellors<br/>3. Community Helpline'
            }).then(function () {
                return botui.action.button({
                    addMessage: false,
                    action: [
                        { text: 'Immediately contact with PolyU-Line Counsellors', value: 5 },
                        { text: 'Make Appointment with SAO Counsellors', value: 3 },
                        { text: 'Community Helpline', value: 6 },
                    ]
                }).then(function (res) {
                    if (res.value == 3) {
                        return botui.message.human({
                            delay: 500,
                            photo: client,
                            content: res.text,
                        }).then(make_appointment_with_counsellors);
                    }
                    if (res.value == 4) {
                        return botui.message.human({
                            delay: 500,
                            photo: client,
                            content: res.text,
                        }).then(contact_with_counsellors);
                    }
                    if (res.value == 5) {
                        return botui.message.human({
                            delay: 500,
                            photo: client,
                            content: res.text,
                        }).then(polyu_line);
                    }
                    if (res.value == 6) {
                        return botui.message.human({
                            delay: 500,
                            photo: client,
                            content: res.text,
                        }).then(community_helpline);
                    }
                })
            })
        }
    }

    function mental_health_101() {
        var office_hour = isSAOWorkingHours(new Date());
        return botui.message.bot({
            loading: true,
            delay: 1500,
            photo: polly,
            content: 'You are being directed to a third-party website.<br/>The responsiblity of its content is subject to ownership of third-party website.'
        }).then(function () {
            return botui.message.bot({
                loading: true,
                delay: 2500,
                photo: polly,
                content: '1. <a href="http://www.google.com" target ="_blank">Academic</a><br/>2. <a href="http://www.google.com" target ="_blank">Interpersonal Relationship</a><br/>3. <a href="http://www.google.com" target ="_blank">Career</a><br/>4. <a href="http://www.google.com" target ="_blank">Family</a><br/>5. <a href="http://www.google.com" target ="_blank">Mental Health</a><br/>6. <a href="https://www.polyu.edu.hk/sao/cws/student-counselling/courses-workshops/for-student/" target ="_blank">CWS Psychological workshops and groups</a>'
            })
        }).then(function () {
            return botui.message.bot({
                loading: true,
                delay: 3000,
                photo: polly,
                content: 'May I assist you with anything further?'
            })
        }).then(function () {
            return botui.action.button({
                addMessage: false,
                action: [
                    { text: 'No, thank you! I will stop here', value: false },
                    { text: 'I still need other services', value: true }
                ]
            })
        }).then(function (res) {
            if (res.value == false) {
                return botui.message.human({
                    delay: 500,
                    photo: client,
                    content: res.text
                }).then(function () {
                    return botui.message.bot({
                        loading: true,
                        delay: 1000,
                        photo: polly,
                        content: 'Please rate your experience'
                    })
                }).then(end)
            } else {
                if (office_hour == true) {
                    return botui.action.button({
                        addMessage: false,
                        action: [
                            { text: 'Make Appointment with SAO Counsellors', value: 1 },
                            { text: 'Immediate Contact with SAO Counsellors', value: 2 },
                        ]
                    }).then(function (res) {
                        if (res.value == 1) {
                            return botui.message.human({
                                delay: 500,
                                photo: client,
                                content: res.text
                            }).then(make_appointment_with_counsellors);
                        }
                        if (res.value == 2) {
                            return botui.message.human({
                                delay: 500,
                                photo: client,
                                content: res.text
                            }).then(contact_with_counsellors);
                        }
                    })
                } else {
                    return botui.action.button({
                        addMessage: false,
                        action: [
                            { text: 'Make Appointment with SAO Counsellors', value: 1 },
                            { text: 'Immediate Contact with PolyU-Line Counsellors: (852)8100-1583', value: 3 },
                        ]
                    }).then(function (res) {
                        if (res.value == 1) {
                            return botui.message.human({
                                delay: 500,
                                photo: client,
                                content: res.text
                            }).then(make_appointment_with_counsellors);
                        }
                        if (res.value == 3) {
                            return botui.message.human({
                                delay: 500,
                                photo: client,
                                content: res.text
                            }).then(polyu_line)
                        }
                    })
                }

            }
        })
    }

    function T_and_C_of_OCS() { //Online Chat Services
        var myDate = new Date();
        pop_msg = "";

        if (myDate.getDay() >=1 && myDate.getDay() <=5) {
            if (myDate.getHours() >=12 && myDate.getHours() <=14) {
                pop_msg = 'We\'ll be back in service at 1400(HKT). We look forward to meeting you !'
            } else if (myDate.getHours() >=18 && myDate.getHours() <=19) {
                pop_msg = 'We\'ll be back during service hours: 0900-1200 & 1400 - 1800 (HKT) , Monday through Friday. We look forward to meeting you !'
            }
        } else {
            pop_msg = 'We\'ll be back at 0900(HKT) in the following working day. We look forward to meeting you !'
        }

        if (pop_msg != "") {
            botui.message.bot({
                loading: true,
                delay: 1500,
                photo: polly,
                content: pop_msg
            }).then(end).then(_close)
        }

        botui.message.bot({
                loading: true,
                delay: 1000,
                photo: polly,
                content: 'We noted that you have accepted the Terms and Conditions of using Counselling ChatBot. Before starting the Online Chat, here are a few reminders:<br/><br/>' +
                        '1. In case of emergency and when ' +
                        'there is an imminent hazard posed to you and others, please call 999 or go to the nearest emergency service / A&E service.<br/><br/>' +
                        '2. Online Chat is available to all registered students of PolyU aged 18 or above.<br/><br/>' +
                        '3. Please do not make record of service in any form so as to protect the confidentiality of the service and service users. <br/><br/>'
        }).then(function () {
            return botui.action.button({
                addMessage: false,
                action: [
                    { text: 'No, I will stop here', value: false },
                    { text: 'Got it', value: true }
                ]
            })
        }).then(function (res) {
            if (res.value == false) {
                return botui.message.human({
                    delay: 500,
                    photo: client,
                    content: res.text
                }).then(function () {
                    return botui.message.bot({
                        loading: true,
                        delay: 1500,
                        photo: polly,
                        content: 'You are always welcome to contact us at (852)27666800 for enquires.'
                    })
                })
            } else {
                return botui.message.human({
                    delay: 500,
                    photo: client,
                    content: res.text
                }).then(questions_before_OCS);
            }
        })
    }

    function questions_before_OCS() {
        var office_hour = isSAOWorkingHours(new Date());
        return botui.message.bot({
            loading: true,
            delay: 1500,
            photo: polly,
            content: 'Online Chat Service please indicate your answers(either Yes or No) below:'
        }).then(function () {
            return botui.message.bot({
                loading: true,
                delay: 1500,
                photo: polly,
                content: 'Q1. Have you ever seen SAO counsellor(s) in the last three months or/and at present?'
            }).then(function () {
                return botui.action.button({
                    addMessage: false,
                    action: [
                        { text: 'Yes', value: true },
                        { text: 'No', value: false }
                    ]
                })
            }).then(function (res) {

                botui.message.human({
                        delay: 500,
                        photo: client,
                        content: res.text
                });

                if (res.value == true) {
                    return botui.message.bot({
                        loading: true,
                        delay: 3000,
                        photo: polly,
                        content: 'We encourage you to contact your existing Counsellor for counselling service directly. Please make appointment with your counsellor via phone (852)27666800, email or <a href="https://www40.polyu.edu.hk/poss/secure/login/loginhome.do" target ="_blank">POSS</a>.'
                    }).then(function () {
                        return botui.message.bot({
                            loading: true,
                            delay: 1500,
                            photo: polly,
                            content: 'Please also feel free to reach ouur online self-help materials here.'
                        })
                    }).then(function () {
                        return botui.action.button({
                            addMessage: false,
                            action: [
                                { text: 'Mental Health 101', value: true },
                                { text: 'End of service', value: false }
                            ]
                        })
                    }).then(function (res) {
                        if (res.value == false) {
                            return botui.message.human({
                                delay: 500,
                                photo: client,
                                content: res.text
                            }).then(end);
                        } else {
                            return botui.message.human({
                                delay: 500,
                                photo: client,
                                content: res.text
                            }).then(mental_health_101);
                        }
                    })
                } else {
                    return botui.message.bot({
                        loading: true,
                        photo: polly,
                        delay: 3000,
                        content: 'Q2.Do you have a history of any of the following:<br/><br/>' +
                            '- Having thoughts of hurting yourself or others, or engaging in self-harming or violent behaviors<br/><br/>' +
                            '- Being admitted to a psychiatric ward, or hospitalized due to a psychiatric condition<br/><br/>' +
                            '- Being diagnosed of mental health problem or illness by psychologists, psychiatrists or doctors, e.g. Major Depressive Disorder, Anxiety Disorder, Schizophrenia, and any Personality Disorders etc <br/><br/>' +
                            '- Being prescribed with medications for treating a mental health related condition'
                    }).then(function () {
                        return botui.action.button({
                            addMessage: false,
                            action: [
                                { text: 'Yes', value: true },
                                { text: 'No', value: false }
                            ]
                        })
                    }).then(function (res) {
                        if (res.value == false) {
                            return botui.message.human({
                                delay: 500,
                                photo: client,
                                content: res.text
                            })
                            .then(function() {
                                return botui.message.bot({
                                    delay: 1000,
                                    photo: polly,
                                    content: 'Please fill in the following information prior starting a conversation with SAO counsellor',
                                });
                            })
                            .then(function () {
                                return botui.action.text({
                                    addMessage: false,
                                    action: {
                                        size: 30,
                                        placeholder: 'Personal Contact Number:'
                                    }
                                });
                            })
                            .then(function (res) { 
                                personalInfo['contactNumber'] = res.value;
                                console.log(personalInfo);
                                return botui.message.add({
                                    human: true, 
                                    photo: client,
                                    content: 'Personal contact number is ' + res.value
                                });
                            })
                            .then(function (res) {
                                return botui.action.text({
                                    addMessage: false,
                                    action: {
                                        size: 30,
                                        placeholder: 'Emergency Contact Name'
                                    }
                                });
                            })
                            .then(function (res) { 
                                personalInfo['emergencyContactName'] = res.value;
                                console.log(personalInfo);
                                return botui.message.add({
                                    human: true,
                                    photo: client,
                                    content: 'Emergency contact name is ' + res.value
                                });
                            })
                            .then(function (res) {
                                return botui.action.text({
                                    addMessage: false,
                                    action: {
                                        size: 30,
                                        placeholder: 'Relationship',
                                    }
                                });
                            })
                            .then(function (res) { 
                                personalInfo['relationship'] = res.value;
                                console.log(personalInfo);
                                return botui.message.add({
                                    human: true, 
                                    photo: client,
                                    content: 'Relationship is ' + res.value
                                });
                            })
                            .then(function (res) {
                                return botui.action.text({
                                    addMessage: false,
                                    action: {
                                        size: 30,
                                        placeholder: 'Emergency Contact Number',
                                    }
                                });
                            })
                            .then(function (res) { 
                                personalInfo['emergencyContactNumber'] = res.value;
                                console.log(personalInfo);
                                return botui.message.add({
                                    human: true,
                                    photo: client,
                                    content: 'Emergency contact number is ' + res.value
                                });
                            })
                            .then(function () {
                                return botui.message.bot({
                                    delay: 1000,
                                    photo: polly,
                                    content: 'Proceeding to Online Chat Service'
                                })
                            }).then(function () {
                                return botui.message.add({
                                    delay: 1000,
                                    photo: polly,
                                    content: 'Please wait, I am now finding a counsellor to chat with you.'
                                });
                            }).then(function () {
                                return botui.message.add({
                                    delay: 3000,
                                    photo: polly,
                                    content: 'You have incoming online chat request, please <a target="_blank" href="http://158.132.255.165:9988/chat/student?student_netid=21&staff_netid=10">click</a> the link to enter the chat room.'
                                });
                            }).then(function() {
                                return botui.message.add({
                                    delay: 1000,
                                    photo: polly,
                                    content: '[Demo only] For counsellor, please <a target="_blank" href="http://158.132.255.165:9988/chat/counsellor?student_netid=21&staff_netid=10">click</a> the link to enter the chat room.'
                                });
                            });
                        } else {
                            return botui.message.human({
                                delay: 500,
                                photo: client,
                                content: res.text
                            }).then(function () {
                                return botui.message.bot({
                                    loading: true,
                                    delay: 2000,
                                    photo: polly,
                                    content: 'For facilitating the comprehensive support to you, you are highly advised to make a face to face appointment with our counsellor.'
                                })
                            }).then(function () {
                                if (office_hour == true) {
                                    return botui.message.bot({
                                        loading: true,
                                        delay: 2000,
                                        photo: polly,
                                        content: '1. Call (852)27666800<br/>2. Walk in QT308(Entrance at Core T) during office hours<br/>3. Email: <a href=mailto:stud.counselling@polyu.edu.hk>stud.counselling@polyu.edu.hk</a><br/>4. Online Booking: Direct to <a href="https://www40.polyu.edu.hk/poss/secure/login/loginhome.do" target ="_blank">POSS</a></br>'
                                    })
                                } else {
                                    return botui.message.bot({
                                        loading: true,
                                        delay: 2000,
                                        photo: polly,
                                        content: '1. Email: <a href=mailto:stud.counselling@polyu.edu.hk>stud.counselling@polyu.edu.hk</a><br/>2. Online Booking: Direct to <a href="https://www40.polyu.edu.hk/poss/secure/login/loginhome.do" target ="_blank">POSS</a></br>'
                                    })
                                }
                            })
                        }
                    }).then(end)
                }
            })
        })
    }

    function make_appointment_with_counsellors() {
        return botui.message.bot({
            loading: true,
            photo: polly,
            delay: 1500,
            content: '1. Email: <a href=mailto:stud.counselling@polyu.edu.hk>stud.counselling@polyu.edu.hk</a><br/>2. Online Booking: Direct to <a href="https://www40.polyu.edu.hk/poss/secure/login/loginhome.do" target ="_blank">POSS</a></br>'
        }).then(further_help)
    }

    function contact_with_counsellors() {
        return botui.message.bot({
            loading: true,
            photo: polly,
            delay: 2000,
            content: 'Immediate Contact with SAO Counsellors<br/>Mon-Fri: 0900 -1900(HKT).<br/>Sat: 0900 - 1200(HKT)'
        }).then(function () {
            return botui.message.bot({
                loading: true,
                photo: polly,
                delay: 1000,
                content: '1. Call (852)27666800<br/>2. Walk in QT308(Entrance at Core T) during office hours</br>'
            })
        }).then(further_help())
    }

    function polyu_line() {
        return botui.message.bot({
            loading: true,
            photo: polly,
            delay: 1500,
            content:
                'Service Hours:<br/>' +
                'Monday to Friday: <br/>00: 00 to 09: 00(HKT) and 19: 00 to 00: 00(HKT)<br/>' +
                'Saturday: <br/>00: 00 to 09: 00(HKT) and 12: 00 to 00: 00(HKT)<br/>' +
                'Sunday and public holidays: <br/>24 hours(HKT) round the clock'
        }).then(function () {
            return botui.message.bot({
                loading: true,
                photo: polly,
                delay: 3000,
                content: 'Immediate Contact with PolyU-Line Counsellors: (852)81001583<br/><br/>All phone calls will be answered by Vital Employee Service Consultancy Christian Family Service Centre.'
            })
        }).then(further_help())
    }

    function community_helpline() {
        return botui.message.bot({
            loading: true,
            photo: polly,
            delay: 3000,
            content: 'Emergency Call: (852)999<br/>Social Welfare Department: (852)23432255<br/>Caritas Family Crisis Support Centre: (852)18288<br/>Suicide Prevention Services: (852)23820000<br/>The Samaritans Multi-lingual Suicide Prevention(852)2896-0000<br/>The Hong Kong Jockey Club Charities Trust, Open Up-24-hour online chat platform: <a href="www.openup.hk" target ="_blank">www.openup.hk</a><br/>'
        }).then(further_help())
    }

    function further_help() {
        return botui.message.bot({
            loading: true,
            photo: polly,
            delay: 3000,
            content: 'May I assist you with anything further?'
        }).then(function () {
            return botui.action.button({
                addMessage: false,
                action: [
                    { text: 'I still need other services.', value: true },
                    { text: 'No, thank you! I will stop here.', value: false },
                ]
            }).then(function (res) {
                if (res.value == true) {
                    if (score <=10) {
                        return botui.message.human({
                            photo: client,
                            delay: 500,
                            content: res.text
                        }).then(mid_recommendations)
                    } else {
                        return botui.message.human({
                            photo: client,
                            delay: 500,
                            content: res.text
                        }).then(high_recommendations)
                    }
                } else {
                    return botui.message.human({
                        photo: client,
                        delay: 500,
                        content: res.text
                    }).then(function () {
                        if (score > 10) {
                            botui.message.bot({
                                loading: true,
                                photo: polly,
                                delay: 1000,
                                content: content = '<font color=blue>In case of emergency and when there is an imminent hazard posed to you and others, please call 999 or go to the nearest emergency service / A&E service.</font>'
                            })
                        }
                    }).then(end)
                }
            })
        })
    }

    function end() {
        rating();
    }


    function rating() {
        botui.message.add({
            type: 'html',
            delay: 1000,
            photo: polly,
            content: '<p>Thank you for using \"My Polly\". \n Please rate your experience:</p >' +
                '<div class="wrap">\n' +
                '  <div class="stars">\n' +
                '    <label class="rate">\n' +
                '      <input type="radio" name="radio1" id="star1" value="star1">\n' +

                '      <i class="far fa-star star one-star available"></i>\n' +
                '    </label>\n' +
                '    <label class="rate">\n' +
                '      <input type="radio" name="radio1" id="star2" value="star2">\n' +

                '      <i class="far fa-star star two-star available"></i>\n' +
                '    </label>\n' +
                '    <label class="rate">\n' +
                '      <input type="radio" name="radio1" id="star3" value="star3">\n' +

                '      <i class="far fa-star star three-star available"></i>\n' +
                '    </label>\n' +
                '    <label class="rate">\n' +
                '      <input type="radio" name="radio1" id="star4" value="star4">\n' +

                '      <i class="far fa-star star four-star available"></i>\n' +
                '    </label>\n' +
                '    <label class="rate">\n' +
                '      <input type="radio" name="radio1" id="star5" value="star5">\n' +

                '      <i class="far fa-star star five-star available"></i>\n' +
                '    </label>\n' +
                '  </div>\n' +
                '</div>'
        }).then(function() {
             botui.action.button({
                    addMessage: false,
                    photo: client,
                    action: [{
                        text: 'Submit my rating',
                    }]
             }).then(function() {
                    // fix the stars
                    console.log($('.far'));

                    $('.far').removeClass('available');
                    botui.message.bot({
                        loading: true,
                        delay: 1000,
                        photo: polly,
                        content: 'Thank you for your valuable feedback!'
                    });
             });

        }).then(_close);
    }

    /*
    function chatting () {
        botui.action.text({ // show 'text' action
                action: {
                    placeholder: 'Enter here'
                }
        }).then(function (res) { // get the result
            if(res.value != 'exit') {
                $(this).ajaxSubmit({
                  type: 'post',
                  url: "{% url 'auto_response' %}",
                  data:{
                      'post': res.value
                  },
                  success: function(data) {
                      response = data;
                      botui.message.add({
                        content: response
                      }).then(chatting())
                  }
                });
            } else {
                botui.message.add({
                    content: 'Bye bye!'
                });
            }
        });
    }
    */
</script>

<script type="text/javascript">
    $(function () {
        $(document).on({
            mouseover: function (event) {
                $(this).find('.available').addClass('star-over');
                $(this).prevAll().find('.available').addClass('star-over');
            },
            mouseleave: function (event) {
                $(this).find('.available').removeClass('star-over');
                $(this).prevAll().find('.available').removeClass('star-over');
            }
        }, '.rate');


        $(document).on('click', '.rate', function () {
            if (!$(this).find('.available').hasClass('rate-active')) {
                $(this).siblings().find('.available').addClass('far').removeClass('fas rate-active');
                $(this).find('.available').addClass('rate-active fas').removeClass('far star-over');
                $(this).prevAll().find('.available').addClass('fas').removeClass('far star-over');
            } else {
                console.log('has');
            }
        })
        .on('click', '.icon-leave', function() {
            if (confirm("Are you sure you want to quit?")) {
                if (navigator.userAgent.indexOf("Firefox") != -1 || navigator.userAgent.indexOf("Chrome") !=-1) {
                    window.location.href="about:blank";
                    window.close();
                } else {
                    window.opener = null;
                    window.open("", "_self");
                    window.close();
                }
            }
        })
        .on('click', '.icon-home', function() {
            location.reload();
        });

    });
</script>
{% endblock javascript %}

</html>
